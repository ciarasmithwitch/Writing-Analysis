<!DOCTYPE html>
<html>
<head>
  <title>Writing Analyzer</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea, input { width: 100%; margin: 10px 0; }
    textarea { height: 200px; }
    button { padding: 10px 15px; font-size: 16px; margin-top: 10px; }
    .result { margin-top: 15px; padding: 10px; border-radius: 6px; }
    .green { background: #d4edda; }
    .yellow { background: #fff3cd; }
    .red { background: #f8d7da; }
  </style>
</head>
<body>
  <h1>Writing Analyzer</h1>
  <label for="names">Character names (comma separated):</label>
  <input type="text" id="names" placeholder="e.g. Connor, Indy, Rosy">
  
  <p>We measure worldbuilding as the percentage of words that are not pronouns (e.g. she/he/I). High percentages may indicate description or exposition. It's a proxy metric.</p>
  
  <label for="text">Paste your text:</label>
  <textarea id="text" maxlength="10000"></textarea><br>
  <button onclick="analyze()">Analyze</button>
  
  <div id="output"></div>

<script>
function analyze() {
  const text = document.getElementById("text").value;
  const namesInput = document.getElementById("names").value || "";
  const totalWords = text.trim().split(/\s+/).filter(Boolean).length;
  let output = "";

  // ---------- Sentence Length ----------
  const sentences = text.split(/[.!?]/).filter(s => s.trim().length > 0);
const longSentences = sentences.filter(s => s.split(" ").length > 20);
const longPercent = sentences.length > 0 ? Math.round((longSentences.length / sentences.length) * 100) : 0;
if(longPercent <= 25) {
    output += `<div class="green result">Great sentence length variety: ${longPercent}% of sentences are long</div>`;
} else if(longPercent <= 60) {
    output += `<div class="yellow result">Moderate long sentences: ${longPercent}% of sentences are long. Consider breaking some up.</div>`;
} else {
    output += `<div class="red result">Too many long sentences: ${longPercent}% of sentences are long</div>`;
}

  // ---------- Telling Words ----------
  const tellingWords = ["suddenly","very","really","felt","knew","realized","angry","sad","happy","chastise","anger","sadness","uncomfortable","anxious"];
  const foundTelling = tellingWords.filter(word => text.toLowerCase().includes(word));
  if(foundTelling.length > 0) {
    output += `<div class="yellow result">Telling words found: ${foundTelling.join(", ")}</div>`;
  } else {
    output += `<div class="green result">No telling words detected!</div>`;
  }

  // ---------- Filter Words ----------
  const filterWords = ["saw","touch","decided","looked","watched","noted","heard","wondered","knew","noticed","sound","experienced","thought","seemed","felt","realized","could","remembered"];
  const foundFilters = filterWords.filter(word => text.toLowerCase().includes(word));
  if(foundFilters.length > 0) {
    output += `<div class="yellow result">Filter words found: ${foundFilters.join(", ")}</div>`;
  } else {
    output += `<div class="green result">No filter words detected!</div>`;
  }

  // ---------- Dialogue ----------
  const dialogueMatches = text.match(/["“”']([^"“”']*)["“”']/g) || [];
  const dialogueWords = dialogueMatches.join(" ").split(/\s+/).filter(Boolean).length;
  const dialoguePercent = totalWords > 0 ? Math.round((dialogueWords / totalWords) * 100) : 0;
  if (dialoguePercent > 50) {
    output += `<div class="red result">Dialogue heavy: ${dialoguePercent}% of words are dialogue</div>`;
  } else if (dialoguePercent > 30) {
    output += `<div class="yellow result">Quite a lot of dialogue: ${dialoguePercent}%</div>`;
  } else {
    output += `<div class="green result">Balanced dialogue: ${dialoguePercent}%</div>`;
  }

  // ---------- Passive Voice ----------
  const passiveWords = ["was","is","am","are","be","being","been","has","were","began to","begin to","starting to","started to"];
  let passiveCount = 0;
  const loweredText = text.toLowerCase();
  passiveWords.forEach(word => {
    const regex = new RegExp("\\b" + word + "\\b", "g");
    const matches = loweredText.match(regex);
    if(matches) passiveCount += matches.length;
  });
  const passivePercent = totalWords > 0 ? Math.round((passiveCount / totalWords) * 100) : 0;
  if(passivePercent > 50) {
    output += `<div class="red result">Passive heavy: ${passivePercent}% of words are passive</div>`;
  } else if(passivePercent > 30) {
    output += `<div class="yellow result">Quite a lot of passive voice: ${passivePercent}%</div>`;
  } else {
    output += `<div class="green result">Balanced between active and passive: ${passivePercent}%</div>`;
  }

// ---------- Character vs Worldbuilding (Sliding Window) ----------
const pronouns = ["she","her","he","him","i","me","my","we","us","our","they","them","their"];
const userNames = namesInput.toLowerCase().split(",").map(n => n.trim()).filter(Boolean);
const characterWords = [...pronouns, ...userNames];
const wordsArray = text.toLowerCase().split(/\s+/).filter(Boolean);
const windowSize = 20;  // number of words per block
const step = 5;         // sliding step
let characterBlocks = 0;
let totalBlocks = 0;
for(let i = 0; i < wordsArray.length; i += step) {
    const block = wordsArray.slice(i, i + windowSize);
    if(block.length === 0) continue;   // skip empty block
    totalBlocks++;
    if(block.some(word => characterWords.includes(word))) {
        characterBlocks++;
    }
}
// Avoid divide-by-zero
const characterPercent = totalBlocks > 0 ? Math.round((characterBlocks / totalBlocks) * 100) : 0;
const worldPercent = 100 - characterPercent;
if(worldPercent > 70) {
    output += `<div class="red result">Heavy on worldbuilding: ${worldPercent}% of text lacks character focus</div>`;
} else if(worldPercent > 50) {
    output += `<div class="yellow result">Quite a bit of worldbuilding: ${worldPercent}% of text lacks character focus</div>`;
} else {
    output += `<div class="green result">Balanced: ${characterPercent}% character-focused, ${worldPercent}% world-focused</div>`;
}


  // ---------- Show output ----------
  document.getElementById("output").innerHTML = output;
}
</script>

</body>
</html>



